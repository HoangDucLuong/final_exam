<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="shortcut icon" href="/assets/images/favicon.svg"
	type="image/x-icon" />
<title>PlainAdmin Demo | Bootstrap 5 Admin Template</title>
<link rel="stylesheet" href="/assets/css/bootstrap.min.css" />
<link rel="stylesheet" href="/assets/css/lineicons.css" type="text/css" />
<link rel="stylesheet" href="/assets/css/materialdesignicons.min.css"
	type="text/css" />
<link rel="stylesheet" href="/assets/css/fullcalendar.css" />
<link rel="stylesheet" href="/assets/css/main.css" />
<style>
.table-warning {
	background-color: #fff3cd;
}
</style>
</head>
<body>
	<div id="preloader">
		<div class="spinner"></div>
	</div>
	<aside class="sidebar-nav-wrapper">
		<div class="navbar-logo">
			<a href="/admin/index"> <img src="/assets/images/logo/logo.svg"
				alt="logo" />
			</a>
		</div>
		<nav class="sidebar-nav">
			<ul>
				<li class="nav-item"><a href="/admin/index"> <span
						class="lni lni-dashboard"> <svg width="20" height="20"
								viewBox="0 0 20 20" fill="none"
								xmlns="http://www.w3.org/2000/svg">
            </svg>
					</span> <span class="text">Dashboard</span>
				</a></li>
				<li class="nav-item"><a href="/admin/contracts/list"> <span
						class="lni lni-bookmark"> <svg width="20" height="20"
								viewBox="0 0 20 20" fill="none"
								xmlns="http://www.w3.org/2000/svg">
            </svg>
					</span> <span class="text">Contracts</span>
				</a></li>

				<li class="nav-item"><a href=""> <span
						class="lni lni-stats-up"> <svg width="20" height="20"
								viewBox="0 0 20 20" fill="none"
								xmlns="http://www.w3.org/2000/svg">
            </svg>
					</span> <span class="text">Invoice</span>
				</a></li>
				<li class="nav-item nav-item-has-children"><a href="#0"
					class="collapsed" data-bs-toggle="collapse"
					data-bs-target="#ddmenu_3" aria-controls="ddmenu_3"
					aria-expanded="false" aria-label="Toggle navigation"> <span
						class="lni lni-menu"> <svg width="20" height="20"
								viewBox="0 0 20 20" fill="none"
								xmlns="http://www.w3.org/2000/svg">
            </svg>
					</span> <span class="text">Menu</span>
				</a>
					<ul id="ddmenu_3" class="collapse">
						<li><a href="/admin/menu/list">Menu List</a></li>
						<li><a href="/admin/menu/add">Add Menu</a></li>
					</ul></li>
				<li class="nav-item nav-item-has-children"><a href="#0"
					class="collapsed" data-bs-toggle="collapse"
					data-bs-target="#ddmenu_4" aria-controls="ddmenu_4"
					aria-expanded="false" aria-label="Toggle navigation"> <span
						class="lni lni-arrow-right"> <svg width="20" height="20"
								viewBox="0 0 20 20" fill="none"
								xmlns="http://www.w3.org/2000/svg">
            </svg>
					</span> <span class="text">Orders</span>
				</a>
					<ul id="ddmenu_4" class="collapse">
						<li><a href="orders.html">Orders List</a></li>
					</ul></li>
				<li class="nav-item nav-item-has-children"><a href="#0"
					class="collapsed" data-bs-toggle="collapse"
					data-bs-target="#ddmenu_5" aria-controls="ddmenu_5"
					aria-expanded="false" aria-label="Toggle navigation"> <span
						class="lni lni-arrow-right"> <svg width="20" height="20"
								viewBox="0 0 20 20" fill="none"
								xmlns="http://www.w3.org/2000/svg">
            </svg>
					</span> <span class="text">Meals</span>
				</a>
					<ul id="ddmenu_5" class="collapse">
						<li><a href="/admin/meal/list">Meal List</a></li>
						<li><a href="/admin/meal-groups">Meal Group</a></li>
						<li><a href="/admin/meal-requests">Meal Request</a></li>
						<li><a href="#">Meal Order</a></li>
					</ul></li>
				<li class="nav-item"><a href="/admin/user-management"> <span
						class="lni lni-user"> <svg width="20" height="20"
								viewBox="0 0 20 20" fill="none"
								xmlns="http://www.w3.org/2000/svg">
            </svg>
					</span> <span class="text">Customer</span>
				</a></li>
				<li class="nav-item"><a href="logout.html"> <span
						class="lni lni-exit"> <svg width="20" height="20"
								viewBox="0 0 20 20" fill="none"
								xmlns="http://www.w3.org/2000/svg">
            </svg>
					</span> <span class="text">Logout</span>
				</a></li>
			</ul>
		</nav>
	</aside>

	<div class="overlay"></div>

	<main class="main-wrapper">
		<header class="header">
			<div class="container-fluid">
				<div class="row">
					<div class="col-lg-5 col-md-5 col-6">
						<div class="header-left d-flex align-items-center">
							<div class="menu-toggle-btn mr-15">
								<button id="menu-toggle" class="main-btn primary-btn btn-hover">
									<i class="lni lni-chevron-left me-2"></i> Menu
								</button>
							</div>
							<div class="header-search d-none d-md-flex">
								<form method="get" action="/admin/contracts/list">
									<input type="text" name="search" placeholder="Tìm kiếm..." />
									<button type="submit" class="btn btn-primary">
										<i class="lni lni-search-alt"></i>
									</button>
								</form>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="col-lg-12">
				<div class="card-style mb-30">
					<div
						class="title d-flex flex-wrap align-items-center justify-content-between">
					</div>
					<div class="left">
						<h6 class="text-medium mb-30">Danh Sách Hợp Đồng</h6>
					</div>
				</div>
				<div class="table-responsive">
					<table class="table table-striped">
						<thead>
							<tr>
								<th><h6 class="text-sm text-medium text-center">ID</h6></th>
								<th class="max-width"><h6
										class="text-sm text-medium text-center">Tên Người Dùng</h6></th>
								<th class="max-width"><h6
										class="text-sm text-medium text-center">Ngày Bắt Đầu</h6></th>
								<th class="max-width"><h6
										class="text-sm text-medium text-center">Ngày Kết Thúc</h6></th>
								<th class="max-width"><h6
										class="text-sm text-medium text-center">Tổng Số Tiền</h6></th>
								<th class="max-width"><h6
										class="text-sm text-medium text-center">Tiền Đặt Cọc</h6></th>
								<th class="max-width"><h6
										class="text-sm text-medium text-center">Trạng Thái Thanh
										Toán Hợp Đồng</h6></th>
								<th class="max-width"><h6
										class="text-sm text-medium text-center">Trạng Thái Hợp
										Đồng</h6></th>
								<th class="max-width"><h6
										class="text-sm text-medium text-center">Hành Động</h6></th>
							</tr>
						</thead>
						<tbody>
							<tr th:each="contractWithUser : ${contracts}" class="text-center"
								th:classappend="${contractWithUser.contract.daysRemaining <= 10} ? 'table-warning' : ''">
								<td><p class="text-sm"
										th:text="${contractWithUser.contract.id}"></p></td>
								<td><p class="text-sm"
										th:text="${contractWithUser.userName}"></td>
								<td><p class="text-sm"
										th:text="${contractWithUser.contract.startDate}"></td>
								<td><p class="text-sm"
										th:text="${contractWithUser.contract.endDate}"></td>
								<td><p class="text-sm"
										th:text="${contractWithUser.contract.totalAmount}"></td>
								<td><p class="text-sm"
										th:text="${contractWithUser.contract.depositAmount}"></td>
								<td><p class="text-sm"
										th:text="${contractWithUser.contract.paymentStatus == 1 ? 'Đã Thanh Toán' : 'Chưa Thanh Toán'}"></td>
								<td><span th:if="${contractWithUser.contract.status == 0}"
									class="status" style="color: red;">Đang chờ</span> <span
									th:if="${contractWithUser.contract.status == 1}" class="status"
									style="color: green;">Đã xác nhận</span> <span
									th:if="${contractWithUser.contract.status == 2}" class="status"
									style="color: orange;">Đang thực hiện</span> <span
									th:if="${contractWithUser.contract.status == 3}" class="status"
									style="color: blue;">Đã hoàn thành</span> <span
									th:if="${contractWithUser.contract.status == 4}" class="status"
									style="color: grey;">Đã hủy</span></td>
								<td>
    <div class="action justify-content-center">
        <!-- Nút Chỉnh Sửa -->
        <a th:href="@{/admin/contracts/edit/{id}(id=${contractWithUser.contract.id})}" class="edit">
            <i class="lni lni-pencil"></i>
        </a>

        <!-- Nút Gửi Mail -->
        <button th:if="${contractWithUser.isExpiringSoon}" th:onclick="'sendMail(' + ${contractWithUser.contract.id} + ')'">
            Gửi Mail
        </button>

        <!-- Nút Xóa -->
        <button class="more-btn ml-10 dropdown-toggle" data-bs-toggle="dropdown">
            <i class="lni lni-more-alt"></i>
        </button>
        <ul class="dropdown-menu dropdown-menu-end">
            <li class="dropdown-item">
                <a th:href="@{/admin/contracts/delete/{id}(id=${contractWithUser.contract.id})}" class="text-gray">Xóa</a>
                        <!-- Nút Xem Hóa Đơn -->
        <a th:href="@{/admin/invoices/contract/{contractId}(contractId=${contractWithUser.contract.id})}"
           class="text-gray">
            Xem Hóa Đơn
        </a>
                
            </li>
        </ul>
    </div>
</td>

							</tr>
						</tbody>
					</table>
				</div>
			</div>
		</header>
	</main>
	<script src="/assets/js/bootstrap.bundle.min.js"></script>
	<script src="/assets/js/Chart.min.js"></script>
	<script src="/assets/js/dynamic-pie-chart.js"></script>
	<script src="/assets/js/moment.min.js"></script>
	<script src="/assets/js/fullcalendar.js"></script>
	<script src="/assets/js/jvectormap.min.js"></script>
	<script src="/assets/js/world-merc.js"></script>
	<script src="/assets/js/polyfill.js"></script>
	<script src="/assets/js/main.js"></script>
	<script>
function sendMail(contractId) {
    fetch(`/admin/contracts/sendMail/${contractId}`, {
        method: 'POST'
    })
    .then(response => {
        if (response.ok) {
            alert("Email đã được gửi thành công!");
        } else {
            alert("Gửi email thất bại.");
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert("Có lỗi xảy ra.");
    });
}
</script>
</body>
</html>
