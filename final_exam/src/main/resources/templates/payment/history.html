<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Lịch sử thanh toán</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f7f8fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .container {
            max-width: 900px;
        }
        .table th, .table td {
            text-align: center;
            vertical-align: middle;
        }
        .table thead {
            background-color: #343a40;
            color: white;
        }
        .pagination .page-item.active .page-link {
            background-color: #0d6efd;
            border-color: #0d6efd;
        }
        .pagination .page-link {
            border: 1px solid #ddd;
        }
        .search-form input {
            border-radius: 0.375rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12);
        }
        .btn-search {
            background-color: #0d6efd;
            color: white;
            border-radius: 0.375rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12);
        }
        .btn-search:hover {
            background-color: #084298;
        }
    </style>
</head>
<body>
<div class="container my-5">
    <h1 class="text-center mb-4">Lịch sử thanh toán</h1>

    <!-- Search form -->
    <div class="mb-4">
        <form method="get" th:action="@{/user/invoices/{contractId}/payment-history(contractId=${contractId})}" class="search-form">
            <div class="d-flex">
                <input type="text" name="search" class="form-control me-2" placeholder="Tìm kiếm theo mã giao dịch" th:value="${search}" />
                <button type="submit" class="btn btn-search">Tìm kiếm</button>
            </div>
        </form>
    </div>

    <!-- No records message -->
    <div th:if="${#lists.isEmpty(payments)}">
        <p class="text-center text-danger">Không tìm thấy lịch sử thanh toán nào.</p>
    </div>

    <!-- Payment records -->
    <div th:unless="${#lists.isEmpty(payments)}">
        <table class="table table-bordered table-striped">
            <thead>
                <tr>
                    <th>Mã giao dịch</th>
                    <th>Ngày thanh toán 
                        <a th:href="@{/user/invoices/{contractId}/payment-history(sortField='paymentDate', sortDir=${reverseSortDir}, contractId=${contractId})}">
                            <span th:text="${sortDir == 'asc' ? '▲' : '▼'}"></span>
                        </a>
                    </th>
                    <th>Số tiền</th>
                    <th>Phương thức thanh toán</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="payment : ${payments}">
                    <td th:text="${payment.transactionRef}"></td>
                    <td th:text="${#temporals.format(payment.paymentDate, 'yyyy-MM-dd HH:mm:ss')}"></td>
                    <td th:text="${payment.paymentAmount}"></td>
                    <td th:text="${payment.paymentMethod}"></td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Pagination -->
    <nav th:if="${totalPages > 1}" class="mt-4">
        <ul class="pagination justify-content-center">
            <li th:classappend="${currentPage == 0 ? 'disabled' : ''}" class="page-item">
                <a th:href="@{/user/invoices/{contractId}/payment-history(page=${currentPage - 1}, size=${size}, sortField=${sortField}, sortDir=${sortDir}, contractId=${contractId})}" class="page-link">Trước</a>
            </li>
            <li th:each="i : ${#numbers.sequence(0, totalPages - 1)}" th:classappend="${currentPage == i ? 'active' : ''}" class="page-item">
                <a th:href="@{/user/invoices/{contractId}/payment-history(page=${i}, size=${size}, sortField=${sortField}, sortDir=${sortDir}, contractId=${contractId})}" class="page-link" th:text="${i + 1}"></a>
            </li>
            <li th:classappend="${currentPage == totalPages - 1 ? 'disabled' : ''}" class="page-item">
                <a th:href="@{/user/invoices/{contractId}/payment-history(page=${currentPage + 1}, size=${size}, sortField=${sortField}, sortDir=${sortDir}, contractId=${contractId})}" class="page-link">Sau</a>
            </li>
        </ul>
    </nav>
</div>

<!-- Bootstrap JS & Popper.js -->
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js"></script>
</body>
</html>
